<div id="micropost-<%= @micropost.id %>">

  <div class="title-bar">
    <%= link_to gravatar_for(@micropost.user, size: 40), @micropost.user %>
    <span class="user"><%= link_to @micropost.user.name, @micropost.user %></span>

    <div id="bookmark_form">
      <% if current_user.bookmarked_microposts?(@micropost) %>
        <%# <%= render 'shared/clear_bookmark' %>
        <%= form_with(model: current_user.bookmarks.find_by(micropost_id: @micropost.id),
                                                html: { method: :delete }, local: true) do |f| %>
          <%= f.submit "お気に入りから外す", class: "btn" %> 
        <% end %> 

      <% else %>
        <%# <%= render 'shared/bookmark' %>
        <%= form_with(model: current_user.bookmarks.build, local: true) do |f| %>
          <div><%= hidden_field_tag :micropost_id, @micropost.id %></div>
          <%= f.submit "お気に入りに入れる", class: "btn btn-primary" %>
        <% end %>

      <% end %>
    </div>
  </div>

  <span class="content">
    <%= image_tag @micropost.picture.url%>
    <%= @micropost.content %>
  </span>

  <ul class= "comments">
    <% @micropost.comments.each do |comment| %>
      <li>
        <%= link_to comment.user.user_name, comment.user %> 
        <%= comment.content %>

        <% if current_user?(comment.user || @micropost.user) %>
          <%= link_to "コメントを削除", micropost_comment_path(@micropost.id, comment.id),
                          method: :delete, data: { confirm: "削除してよろしいですか？" } %>
        <% end %>
      </li>
    <% end %>
  </ul>

  <div class="comment-post">
    <%= form_with(model: [@micropost, @comment], url: micropost_comments_path(@micropost.id),
                                                      method: :post, local: true) do |f| %>
      <%= render 'shared/error_messages', object: f.object %>
      <%= f.text_field :content %>
      <%= f.submit 'コメントする' %> 
      <%# <%binding.pry%>

    <% end %>
  </div>

  <span class="timestamp">
    <%= time_ago_in_words(@micropost.created_at) %>前に投稿 |
    <% if current_user?(@micropost.user) %>
      <%= link_to "投稿を削除", micropost, method: :delete,
                                       data: { confirm: "削除してよろしいですか？" } %>
    <% end %>
  </span>

</div>